# База данных AutoParts Pro

## Структура базы данных

### Основные таблицы

1. **categories** - Категории товаров (с поддержкой вложенности)
2. **manufacturers** - Производители
3. **products** - Товары с полной информацией
4. **product_attributes** - Атрибуты товаров (размер, цвет и т.д.)
5. **product_attribute_values** - Значения атрибутов
6. **users** - Пользователи (админы, менеджеры, клиенты)
7. **user_addresses** - Адреса пользователей
8. **orders** - Заказы
9. **order_items** - Позиции заказов
10. **cart_items** - Корзина покупок
11. **reviews** - Отзывы и рейтинги

## Доступ к Adminer

### Через веб-интерфейс

1. Запустите Docker контейнеры: `docker-compose up -d`
2. Откройте: **http://localhost:8080**
3. Войдите с параметрами:
   - **Система:** MySQL
   - **Сервер:** db
   - **Пользователь:** autoparts_user
   - **Пароль:** autoparts_pass
   - **База данных:** autoparts_db

### Root доступ (для разработки)

- **Пользователь:** root
- **Пароль:** rootpassword

## Импорт/Экспорт данных

### Импорт CSV через Adminer

1. Откройте таблицу в Adminer
2. Нажмите "Импорт"
3. Выберите CSV файл
4. Настройте параметры (разделитель, кодировка)
5. Нажмите "Выполнить"

### Экспорт данных

1. Выберите таблицу или выполните SQL запрос
2. Нажмите "Экспорт"
3. Выберите формат (CSV, SQL, JSON)
4. Скачайте файл

### Массовая загрузка товаров

Для загрузки большого количества товаров:

1. Подготовьте CSV файл со структурой:
```csv
name,slug,sku,description,short_description,category_id,manufacturer_id,price,stock_quantity
Товар 1,product-1,SKU-001,Описание,Краткое описание,1,1,1000.00,50
```

2. Импортируйте через Adminer или используйте SQL:
```sql
LOAD DATA INFILE '/path/to/products.csv'
INTO TABLE products
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS;
```

## Оптимизация для больших объемов

### Индексы

Все ключевые поля проиндексированы:
- Поиск по названию товара (FULLTEXT)
- Фильтрация по категориям
- Сортировка по цене
- Поиск по SKU

### Рекомендации

1. **Партиционирование** - для таблиц с миллионами записей
2. **Кэширование** - Redis для часто запрашиваемых данных
3. **Репликация** - для чтения с нескольких серверов
4. **Архивирование** - старые заказы в отдельные таблицы

## Миграции

SQL скрипты автоматически выполняются при первом запуске контейнера:
- `01_schema.sql` - структура таблиц
- `02_indexes.sql` - индексы для оптимизации
- `03_sample_data.sql` - тестовые данные
- `04_triggers.sql` - триггеры для автоматизации

## Резервное копирование

### Создание бэкапа

```bash
docker exec autoparts-db mysqldump -u root -prootpassword autoparts_db > backup.sql
```

### Восстановление

```bash
docker exec -i autoparts-db mysql -u root -prootpassword autoparts_db < backup.sql
```

## Производительность

### Настройки MySQL для больших объемов

В `docker-compose.yml` уже настроено:
- `max_allowed_packet=256M` - для больших запросов
- `innodb_buffer_pool_size=512M` - кэш для InnoDB

### Мониторинг

Используйте Adminer для:
- Просмотра статистики таблиц
- Анализа медленных запросов
- Оптимизации индексов

